{% extends 'superadmin/base.html' %}

{% block header %}Configuraci√≥n Verifactu - Desarrollador{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <form method="post" class="space-y-8">
        {% csrf_token %}

        <!-- Info Banner -->
        <div class="glass-panel p-4 rounded-xl border border-amber-500/30 bg-amber-500/5">
            <div class="flex items-start gap-3">
                <svg class="w-6 h-6 text-amber-400 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <div>
                    <h4 class="text-sm font-semibold text-amber-300">¬øQu√© es esto?</h4>
                    <p class="text-sm text-gray-400 mt-1">
                        Verifactu (RD 1007/2023) es el sistema espa√±ol de facturaci√≥n verificable de la AEAT. 
                        Esta configuraci√≥n define los datos del <strong class="text-white">desarrollador del software</strong> (t√∫ o tu empresa) 
                        que se incluir√°n en todas las facturas verificables de los gimnasios que activen este m√≥dulo.
                    </p>
                </div>
            </div>
        </div>

        <!-- Software Info -->
        <div class="glass-panel p-6 rounded-xl border border-indigo-500/30 shadow-[0_0_15px_rgba(99,102,241,0.1)]">
            <div class="flex items-center justify-between mb-4 border-b border-gray-800 pb-2">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-6 h-6 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                    </svg>
                    Informaci√≥n del Software
                </h3>
                <span class="text-xs bg-indigo-500/10 text-indigo-400 border border-indigo-500/20 px-2 py-1 rounded">Obligatorio</span>
            </div>
            <p class="text-sm text-gray-400 mb-6">Datos del sistema de facturaci√≥n que se registran ante la AEAT.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Nombre del Software</label>
                    <input type="text" name="software_name" value="{{ config.software_name }}" required
                           placeholder="GymCRM"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-white focus:ring-indigo-500 focus:border-indigo-500">
                    <p class="text-xs text-gray-500 mt-1">Nombre comercial del sistema</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Versi√≥n</label>
                    <input type="text" name="software_version" value="{{ config.software_version }}" required
                           placeholder="1.0.0"
                           class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-white focus:ring-indigo-500 focus:border-indigo-500">
                    <p class="text-xs text-gray-500 mt-1">Versi√≥n actual del software</p>
                </div>
            </div>
        </div>

        <!-- Developer Info -->
        <div class="glass-panel p-6 rounded-xl border border-purple-500/30 shadow-[0_0_15px_rgba(168,85,247,0.1)]">
            <div class="flex items-center justify-between mb-4 border-b border-gray-800 pb-2">
                <h3 class="text-lg font-semibold text-white flex items-center">
                    <svg class="w-6 h-6 mr-2 text-purple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                    </svg>
                    Datos del Desarrollador
                </h3>
                <span class="text-xs bg-purple-500/10 text-purple-400 border border-purple-500/20 px-2 py-1 rounded">Tu empresa</span>
            </div>
            <p class="text-sm text-gray-400 mb-6">Informaci√≥n fiscal de la empresa que desarrolla el software de facturaci√≥n.</p>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-2">Pa√≠s del Desarrollador</label>
                    <select name="developer_country" id="developer_country"
                            onchange="updateTaxIdLabel()"
                            class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-white focus:ring-purple-500 focus:border-purple-500">
                        {% for value, label in country_choices %}
                        <option value="{{ value }}" {% if config.developer_country == value %}selected{% endif %}>
                            {% if value == 'ES' %}üá™üá∏{% elif value == 'EU' %}üá™üá∫{% elif value == 'US' %}üá∫üá∏{% else %}üåç{% endif %}
                            {{ label }}
                        </option>
                        {% endfor %}
                    </select>
                    <p class="text-xs text-gray-500 mt-1">Pa√≠s donde est√° registrada tu empresa</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label id="tax_id_label" class="block text-sm font-medium text-gray-400 mb-2">NIF del Desarrollador</label>
                        <input type="text" name="developer_tax_id" id="developer_tax_id" value="{{ config.developer_tax_id }}"
                               placeholder="B12345678"
                               class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-white focus:ring-purple-500 focus:border-purple-500">
                        <p id="tax_id_hint" class="text-xs text-gray-500 mt-1">Formato: X-XXXXXXXX (9 caracteres)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Nombre / Raz√≥n Social</label>
                        <input type="text" name="developer_name" value="{{ config.developer_name }}"
                               placeholder="Mi Empresa SL"
                               class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-white focus:ring-purple-500 focus:border-purple-500">
                        <p class="text-xs text-gray-500 mt-1">Nombre legal de tu empresa</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview -->
        <div class="glass-panel p-6 rounded-xl border border-gray-700">
            <h3 class="text-sm font-semibold text-gray-400 mb-3 flex items-center">
                <svg class="w-4 h-4 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                </svg>
                Vista previa en facturas
            </h3>
            <div class="bg-gray-900/50 p-4 rounded-lg border border-gray-800 font-mono text-sm text-gray-300">
                <p>Software de Facturaci√≥n: <span class="text-white">{{ config.software_name }} v{{ config.software_version }}</span></p>
                <p class="mt-1">Desarrollador: <span class="text-white">{{ config.developer_name|default:"(Sin especificar)" }}</span></p>
                <p class="mt-1">{{ config.get_tax_id_label }}: <span class="text-white">{{ config.developer_tax_id|default:"(Sin especificar)" }}</span></p>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-between pt-4">
            <a href="{% url 'superadmin:dashboard' %}" 
               class="px-4 py-2 text-gray-400 hover:text-white transition">
                ‚Üê Volver al Dashboard
            </a>
            <button type="submit" class="px-6 py-3 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium shadow-lg shadow-purple-500/20 transition flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Guardar Configuraci√≥n
            </button>
        </div>
    </form>
</div>

<script>
function updateTaxIdLabel() {
    const country = document.getElementById('developer_country').value;
    const label = document.getElementById('tax_id_label');
    const hint = document.getElementById('tax_id_hint');
    const input = document.getElementById('developer_tax_id');
    
    const config = {
        'ES': { label: 'NIF del Desarrollador', placeholder: 'B12345678', hint: 'Formato: X-XXXXXXXX (9 caracteres)' },
        'EU': { label: 'VAT Number', placeholder: 'DE123456789', hint: 'N√∫mero de IVA intracomunitario con prefijo de pa√≠s' },
        'US': { label: 'EIN (Employer Identification Number)', placeholder: '12-3456789', hint: 'Formato: XX-XXXXXXX (9 d√≠gitos con gui√≥n)' },
        'OTHER': { label: 'Tax ID / Identificaci√≥n Fiscal', placeholder: '', hint: 'N√∫mero de identificaci√≥n fiscal de tu pa√≠s' }
    };
    
    const c = config[country] || config['OTHER'];
    label.textContent = c.label;
    input.placeholder = c.placeholder;
    hint.textContent = c.hint;
}

// Run on page load
document.addEventListener('DOMContentLoaded', updateTaxIdLabel);
</script>
{% endblock %}
