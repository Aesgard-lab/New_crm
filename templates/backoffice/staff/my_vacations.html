{% extends "backoffice/base.html" %}

{% block title %}Mis Vacaciones - {{ request.gym.name }}{% endblock %}

{% block page_title %}
<div>Mis Vacaciones</div>
<div class="text-sm font-normal text-slate-500 mt-1">Gestiona tus d√≠as de descanso</div>
{% endblock %}

{% block content %}

<!-- Navigation Tabs -->
<div class="mb-6 flex flex-wrap gap-2">
  <a href="{% url 'vacation_calendar' %}" 
     class="px-4 py-2 rounded-xl text-sm font-medium bg-white text-slate-600 hover:bg-slate-50 border border-slate-200">
    üìÖ Calendario
  </a>
  <a href="{% url 'my_vacations' %}" 
     class="px-4 py-2 rounded-xl text-sm font-medium bg-slate-900 text-white">
    üèñÔ∏è Mis Vacaciones
  </a>
</div>

<div class="grid lg:grid-cols-3 gap-6">
  
  <!-- Balance Card -->
  <div class="lg:col-span-1">
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
      <h3 class="text-lg font-bold text-slate-900 mb-4">Balance {{ current_year }}</h3>
      
      <!-- Balance visual -->
      <div class="mb-6">
        <div class="flex justify-between text-sm text-slate-600 mb-2">
          <span>Usados</span>
          <span>{{ balance.days_used|floatformat:1 }} de {{ balance.total_days|floatformat:1 }} d√≠as</span>
        </div>
        <div class="w-full bg-slate-100 rounded-full h-4 overflow-hidden">
          {% widthratio balance.days_used balance.total_days 100 as used_pct %}
          {% widthratio balance.days_pending balance.total_days 100 as pending_pct %}
          <div class="h-full flex">
            <div class="bg-emerald-500 h-full" style="width: {{ used_pct|default:0 }}%"></div>
            <div class="bg-amber-400 h-full" style="width: {{ pending_pct|default:0 }}%"></div>
          </div>
        </div>
        <div class="flex gap-4 mt-2 text-xs text-slate-500">
          <div class="flex items-center gap-1">
            <span class="w-3 h-3 bg-emerald-500 rounded"></span> Usados
          </div>
          <div class="flex items-center gap-1">
            <span class="w-3 h-3 bg-amber-400 rounded"></span> Pendientes
          </div>
          <div class="flex items-center gap-1">
            <span class="w-3 h-3 bg-slate-200 rounded"></span> Disponibles
          </div>
        </div>
      </div>
      
      <!-- Numbers -->
      <div class="grid grid-cols-2 gap-4">
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-emerald-600">{{ balance.days_available|floatformat:1 }}</div>
          <div class="text-xs text-slate-500">Disponibles</div>
        </div>
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-amber-600">{{ balance.days_pending|floatformat:1 }}</div>
          <div class="text-xs text-slate-500">Pendientes</div>
        </div>
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-blue-600">{{ balance.days_used|floatformat:1 }}</div>
          <div class="text-xs text-slate-500">Usados</div>
        </div>
        <div class="bg-slate-50 rounded-xl p-4 text-center">
          <div class="text-2xl font-bold text-slate-600">{{ balance.total_days|floatformat:1 }}</div>
          <div class="text-xs text-slate-500">Total a√±o</div>
        </div>
      </div>
      
      {% if balance.days_carried_over > 0 %}
      <div class="mt-4 p-3 bg-blue-50 text-blue-700 rounded-xl text-sm">
        <strong>D√≠as arrastrados:</strong> {{ balance.days_carried_over|floatformat:1 }} d√≠as del a√±o anterior
      </div>
      {% endif %}
      
      <a href="{% url 'vacation_request_create' %}" 
         class="mt-6 w-full bg-slate-900 hover:bg-slate-800 text-white px-4 py-3 rounded-xl text-sm font-medium transition-colors flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Nueva Solicitud
      </a>
    </div>
  </div>
  
  <!-- Requests List -->
  <div class="lg:col-span-2">
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
      <div class="px-6 py-4 border-b border-slate-100">
        <h3 class="text-lg font-bold text-slate-900">Mis Solicitudes</h3>
      </div>
      
      {% if my_requests %}
      <div class="divide-y divide-slate-100">
        {% for req in my_requests %}
        <div class="px-6 py-4 hover:bg-slate-50 flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 rounded-xl flex items-center justify-center
              {% if req.status == 'APPROVED' %}bg-emerald-100 text-emerald-600
              {% elif req.status == 'REJECTED' %}bg-red-100 text-red-600
              {% elif req.status == 'CANCELLED' %}bg-slate-100 text-slate-400
              {% else %}bg-amber-100 text-amber-600{% endif %}">
              {% if req.status == 'APPROVED' %}‚úì
              {% elif req.status == 'REJECTED' %}‚úó
              {% elif req.status == 'CANCELLED' %}‚Äî
              {% else %}‚è≥{% endif %}
            </div>
            <div>
              <div class="font-medium text-slate-900">
                {{ req.absence_type.name }}
              </div>
              <div class="text-sm text-slate-500">
                {{ req.start_date|date:"d M Y" }} ‚Üí {{ req.end_date|date:"d M Y" }}
                <span class="text-slate-400">¬∑</span>
                {{ req.working_days }} d√≠as
              </div>
            </div>
          </div>
          <div class="flex items-center gap-3">
            <span class="px-3 py-1 rounded-full text-xs font-medium
              {% if req.status == 'APPROVED' %}bg-emerald-100 text-emerald-700
              {% elif req.status == 'REJECTED' %}bg-red-100 text-red-700
              {% elif req.status == 'CANCELLED' %}bg-slate-100 text-slate-500
              {% else %}bg-amber-100 text-amber-700{% endif %}">
              {{ req.get_status_display }}
            </span>
            {% if req.status == 'PENDING' or req.status == 'DRAFT' %}
            <form method="post" action="{% url 'vacation_request_cancel' req.pk %}" 
                  onsubmit="return confirm('¬øCancelar esta solicitud?')">
              {% csrf_token %}
              <button type="submit" class="text-slate-400 hover:text-red-600 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </form>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="px-6 py-12 text-center text-slate-400">
        <div class="text-4xl mb-2">üèñÔ∏è</div>
        <p>No tienes solicitudes de vacaciones a√∫n.</p>
        <p class="text-sm mt-1">¬°Solicita tus d√≠as de descanso!</p>
      </div>
      {% endif %}
    </div>
  </div>
  
</div>

{% endblock %}
