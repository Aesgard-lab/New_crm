{% extends 'base/base.html' %}
{% load static %}

{% block title %}{{ title }} - Backoffice{% endblock %}

{% block content %}
<div class="min-h-screen bg-slate-50">
    <!-- Header -->
    <div class="bg-white border-b border-slate-200">
        <div class="max-w-4xl mx-auto px-4 py-6 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <h1 class="text-3xl font-bold text-slate-900">{{ title }}</h1>
                <a href="{% url 'incentive_list' %}" class="inline-flex items-center px-4 py-2 border border-slate-300 rounded-lg shadow-sm text-sm font-medium text-slate-700 bg-white hover:bg-slate-50">
                    ‚Üê Volver
                </a>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
        
        {% if messages %}
            {% for message in messages %}
                <div class="mb-6 p-4 rounded-lg bg-green-50 text-green-800 border border-green-200">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <form method="post" class="bg-white rounded-xl shadow-sm border border-slate-200">
            {% csrf_token %}

            <!-- Help Card -->
            <div class="px-6 py-4 border-b border-slate-200 bg-blue-50">
                <p class="text-sm text-blue-900">
                    <span class="font-semibold">üí° Tipos de Incentivo:</span><br>
                    ‚Ä¢ <strong>% Comisi√≥n Venta:</strong> Porcentaje sobre el total de ventas<br>
                    ‚Ä¢ <strong>Fijo por Venta:</strong> Cantidad fija por cada venta<br>
                    ‚Ä¢ <strong>Fijo por Clase:</strong> Pago por clase impartida<br>
                    ‚Ä¢ <strong>Variable por Asistente:</strong> Pago variable seg√∫n asistencia a clase<br><br>
                    <span class="font-semibold">üéØ Filtros Opcionales:</span> Todos los campos de actividad, horario y d√≠as son opcionales. D√©jalos vac√≠os para aplicar a "todo".
                </p>
            </div>

            <!-- Form Fields -->
            <div class="p-6 space-y-6">

                <!-- Nombre -->
                <div>
                    <label for="{{ form.name.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                        {{ form.name.label }}
                    </label>
                    {{ form.name }}
                    {% if form.name.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.name.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Tipo -->
                <div>
                    <label for="{{ form.type.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                        {{ form.type.label }}
                    </label>
                    {{ form.type }}
                    {% if form.type.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.type.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Valor -->
                <div>
                    <label for="{{ form.value.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                        {{ form.value.label }} 
                        <span class="text-slate-500 text-xs font-normal">(n√∫mero - porcentaje o cantidad)</span>
                    </label>
                    {{ form.value }}
                    {% if form.value.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.value.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Aplicar a Staff -->
                <div>
                    <label for="{{ form.staff.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                        {{ form.staff.label }}
                        <span class="text-slate-500 text-xs font-normal">(dejar vac√≠o = aplicar a todo el equipo)</span>
                    </label>
                    {{ form.staff }}
                    {% if form.staff.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.staff.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- FILTROS DE ACTIVIDAD -->
                <div class="col-span-2 mt-4">
                    <div class="bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200">
                        <h3 class="text-lg font-bold text-purple-900 mb-4 flex items-center gap-2">
                            üéØ Filtros de Actividad <span class="text-xs font-normal text-purple-700">(Opcional)</span>
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Actividad Espec√≠fica -->
                            <div>
                                <label for="{{ form.activity.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                                    üìå {{ form.activity.label }}
                                </label>
                                {{ form.activity }}
                                <p class="mt-1 text-xs text-slate-600">Selecciona UNA actividad espec√≠fica (ej: Yoga, Spinning)</p>
                                {% if form.activity.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.activity.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Categor√≠a Completa -->
                            <div>
                                <label for="{{ form.activity_category.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                                    üìÅ {{ form.activity_category.label }}
                                </label>
                                {{ form.activity_category }}
                                <p class="mt-1 text-xs text-slate-600">O toda una categor√≠a (ej: Cardiovascular, Fuerza)</p>
                                {% if form.activity_category.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.activity_category.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <p class="mt-3 text-xs text-purple-800 bg-purple-100 px-3 py-2 rounded-lg">
                            ‚ö†Ô∏è <strong>No selecciones ambos:</strong> Elige actividad espec√≠fica O categor√≠a completa, nunca ambos.
                        </p>
                    </div>
                </div>

                <!-- FILTROS DE HORARIO -->
                <div class="col-span-2 mt-4">
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl border border-blue-200">
                        <h3 class="text-lg font-bold text-blue-900 mb-4 flex items-center gap-2">
                            ‚è∞ Franja Horaria <span class="text-xs font-normal text-blue-700">(Opcional)</span>
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- Hora Inicio -->
                            <div>
                                <label for="{{ form.time_start.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                                    üïê {{ form.time_start.label }}
                                </label>
                                {{ form.time_start }}
                                {% if form.time_start.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.time_start.errors.0 }}</p>
                                {% endif %}
                            </div>

                            <!-- Hora Fin -->
                            <div>
                                <label for="{{ form.time_end.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                                    üïê {{ form.time_end.label }}
                                </label>
                                {{ form.time_end }}
                                {% if form.time_end.errors %}
                                    <p class="mt-1 text-sm text-red-600">{{ form.time_end.errors.0 }}</p>
                                {% endif %}
                            </div>
                        </div>
                        
                        <p class="mt-3 text-xs text-blue-800 bg-blue-100 px-3 py-2 rounded-lg">
                            üí° <strong>Ejemplo:</strong> 06:00 - 12:00 para clases de ma√±ana, 18:00 - 22:00 para clases nocturnas
                        </p>
                    </div>
                </div>

                <!-- FILTROS DE D√çAS DE LA SEMANA -->
                <div class="col-span-2 mt-4">
                    <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200">
                        <h3 class="text-lg font-bold text-green-900 mb-4 flex items-center gap-2">
                            üìÖ D√≠as de la Semana <span class="text-xs font-normal text-green-700">(Opcional)</span>
                        </h3>
                        
                        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-3">
                            <!-- Lunes -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.monday }}
                                <span class="text-sm font-medium text-slate-900">Lun</span>
                            </label>
                            
                            <!-- Martes -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.tuesday }}
                                <span class="text-sm font-medium text-slate-900">Mar</span>
                            </label>
                            
                            <!-- Mi√©rcoles -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.wednesday }}
                                <span class="text-sm font-medium text-slate-900">Mi√©</span>
                            </label>
                            
                            <!-- Jueves -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.thursday }}
                                <span class="text-sm font-medium text-slate-900">Jue</span>
                            </label>
                            
                            <!-- Viernes -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.friday }}
                                <span class="text-sm font-medium text-slate-900">Vie</span>
                            </label>
                            
                            <!-- S√°bado -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.saturday }}
                                <span class="text-sm font-medium text-slate-900">S√°b</span>
                            </label>
                            
                            <!-- Domingo -->
                            <label class="flex items-center gap-2 p-3 bg-white rounded-lg border border-slate-200 hover:border-green-400 hover:bg-green-50 cursor-pointer transition">
                                {{ form.sunday }}
                                <span class="text-sm font-medium text-slate-900">Dom</span>
                            </label>
                        </div>
                        
                        <p class="mt-3 text-xs text-green-800 bg-green-100 px-3 py-2 rounded-lg">
                            ‚ÑπÔ∏è <strong>Dejar todo sin marcar = todos los d√≠as.</strong> Marca solo los d√≠as espec√≠ficos si quieres limitar.
                        </p>
                    </div>
                </div>

                <!-- Criterios (JSON) - OPCIONAL AVANZADO -->
                <div class="col-span-2">
                    <label for="{{ form.criteria.id_for_label }}" class="block text-sm font-semibold text-slate-900 mb-2">
                        {{ form.criteria.label }}
                        <span class="text-slate-500 text-xs font-normal">(Avanzado - Opcional)</span>
                    </label>
                    {{ form.criteria }}
                    <p class="mt-2 text-xs text-slate-600">
                        Ej: <code class="bg-slate-100 px-2 py-1 rounded">{"product_type": "membership"}</code>
                    </p>
                    {% if form.criteria.errors %}
                        <p class="mt-1 text-sm text-red-600">{{ form.criteria.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Estado Activo -->
                <div class="flex items-center gap-3">
                    {{ form.is_active }}
                    <label for="{{ form.is_active.id_for_label }}" class="text-sm font-semibold text-slate-900">
                        {{ form.is_active.label }}
                    </label>
                    {% if form.is_active.errors %}
                        <p class="text-sm text-red-600">{{ form.is_active.errors.0 }}</p>
                    {% endif %}
                </div>

                <!-- Non-field Errors -->
                {% if form.non_field_errors %}
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <p class="text-sm text-red-800 font-semibold">Errores encontrados:</p>
                        {% for error in form.non_field_errors %}
                            <p class="text-sm text-red-700 mt-1">‚Ä¢ {{ error }}</p>
                        {% endfor %}
                    </div>
                {% endif %}

            </div>

            <!-- Footer Actions -->
            <div class="px-6 py-4 bg-slate-50 border-t border-slate-200 rounded-b-xl flex gap-3 justify-end">
                <a href="{% url 'incentive_list' %}" class="inline-flex items-center px-4 py-2 border border-slate-300 rounded-lg text-sm font-medium text-slate-700 bg-white hover:bg-slate-100">
                    Cancelar
                </a>
                <button type="submit" class="btn-brand px-6 py-2 text-sm">
                    {% if is_create %}
                        ‚úö Crear Incentivo
                    {% else %}
                        üíæ Guardar Cambios
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}
