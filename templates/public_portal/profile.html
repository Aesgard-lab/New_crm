{% extends 'public_portal/base.html' %}

{% block title %}Mi Perfil - {{ gym.commercial_name|default:gym.name }}{% endblock %}

{% block extra_css %}
<style>
    .profile-header {
        background: linear-gradient(135deg, var(--brand-color) 0%, color-mix(in srgb, var(--brand-color) 70%, black) 100%);
    }
    
    .menu-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        gap: 1rem;
        transition: all 0.2s;
        border-radius: 0.75rem;
    }
    .menu-item:hover {
        background: #f8fafc;
    }
    .menu-item:active {
        background: #f1f5f9;
    }
    
    .menu-icon {
        width: 44px;
        height: 44px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        flex-shrink: 0;
    }
    
    .badge-count {
        background: #ef4444;
        color: white;
        font-size: 0.65rem;
        font-weight: 700;
        padding: 0.1rem 0.4rem;
        border-radius: 9999px;
        position: absolute;
        top: -4px;
        right: -4px;
        min-width: 18px;
        text-align: center;
    }
    
    .stat-card {
        text-align: center;
        padding: 1rem;
        background: white;
        border-radius: 1rem;
        flex: 1;
    }
    
    .membership-card {
        background: linear-gradient(135deg, var(--brand-color) 0%, color-mix(in srgb, var(--brand-color) 70%, black) 100%);
        color: white;
        border-radius: 1.25rem;
        padding: 1.5rem;
        position: relative;
        overflow: hidden;
    }
    .membership-card::after {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    }
</style>
{% endblock %}

{% block content %}
<!-- Header del perfil -->
<div class="profile-header -mx-4 sm:-mx-6 lg:-mx-8 -mt-8 px-4 sm:px-6 lg:px-8 pt-8 pb-24 text-white relative">
    <!-- Patr√≥n decorativo -->
    <div class="absolute top-0 right-0 w-64 h-64 opacity-10">
        <svg viewBox="0 0 200 200">
            <circle cx="100" cy="100" r="80" fill="white"/>
            <circle cx="100" cy="100" r="60" fill="none" stroke="white" stroke-width="2"/>
            <circle cx="100" cy="100" r="40" fill="none" stroke="white" stroke-width="2"/>
        </svg>
    </div>
    
    <div class="relative z-10">
        <div class="flex items-center justify-between mb-6">
            <h1 class="text-2xl font-bold">Mi Perfil</h1>
            <a href="{% url 'public_logout' slug=settings.public_slug %}" class="w-10 h-10 bg-white/20 backdrop-blur rounded-full flex items-center justify-center hover:bg-white/30 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
            </a>
        </div>
        
        <div class="flex items-center gap-4">
            <!-- Avatar -->
            <div class="w-20 h-20 rounded-full bg-white/20 backdrop-blur flex items-center justify-center border-4 border-white/30 overflow-hidden">
                {% if client.photo %}
                <img src="{{ client.photo.url }}" alt="{{ client.first_name }}" class="w-full h-full object-cover">
                {% else %}
                <span class="text-3xl font-bold">{{ client.first_name|slice:":1"|upper }}</span>
                {% endif %}
            </div>
            
            <div>
                <h2 class="text-xl font-bold">{{ client.first_name }} {{ client.last_name }}</h2>
                <p class="text-white/80">{{ client.email }}</p>
                {% if client.status == 'ACTIVE' %}
                <span class="inline-block mt-1 px-2 py-0.5 bg-green-400/30 text-green-100 text-xs font-bold rounded-full">‚úì Activo</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Contenido principal (superpuesto al header) -->
<div class="-mt-16 relative z-10 space-y-6">
    
    <!-- Membres√≠a Activa (tarjeta destacada) -->
    {% if active_membership %}
    <div class="membership-card">
        <div class="relative z-10">
            <div class="flex items-start justify-between mb-4">
                <div>
                    <p class="text-white/70 text-sm">Tu membres√≠a</p>
                    <h3 class="text-xl font-bold">{{ active_membership.plan.name }}</h3>
                </div>
                <span class="px-3 py-1 bg-white/20 rounded-full text-xs font-bold backdrop-blur">
                    {{ active_membership.get_status_display }}
                </span>
            </div>
            
            {% if active_membership.end_date %}
            <div class="flex items-center gap-2 text-sm text-white/80">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
                <span>V√°lida hasta {{ active_membership.end_date|date:"d M, Y" }}</span>
            </div>
            {% endif %}
            
            {% if active_membership.sessions_remaining != None %}
            <div class="mt-4">
                <div class="flex items-center justify-between text-sm mb-2">
                    <span>Sesiones restantes</span>
                    <span class="font-bold">{{ active_membership.sessions_remaining }}/{{ active_membership.sessions_total }}</span>
                </div>
                <div class="w-full h-2 bg-white/20 rounded-full overflow-hidden">
                    <div class="h-full bg-white rounded-full" style="width: {{ active_membership.sessions_percentage }}%"></div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="bg-white rounded-2xl shadow-lg p-6 text-center">
        <div class="text-4xl mb-3">üí≥</div>
        <h3 class="font-bold text-slate-900 mb-1">Sin membres√≠a activa</h3>
        <p class="text-slate-500 text-sm mb-4">Adquiere un plan para empezar</p>
        <a href="{% url 'public_pricing' slug=settings.public_slug %}" class="inline-block brand-bg text-white font-bold px-6 py-3 rounded-xl">
            Ver Planes
        </a>
    </div>
    {% endif %}
    
    <!-- Estad√≠sticas r√°pidas -->
    <div class="flex gap-3">
        <div class="stat-card shadow-lg border border-slate-100">
            <div class="text-2xl font-bold text-slate-900">{{ stats.total_visits }}</div>
            <div class="text-xs text-slate-500">Visitas</div>
        </div>
        <div class="stat-card shadow-lg border border-slate-100">
            <div class="text-2xl font-bold text-slate-900">{{ stats.current_streak }}</div>
            <div class="text-xs text-slate-500">üî• Racha</div>
        </div>
        <div class="stat-card shadow-lg border border-slate-100">
            <div class="text-2xl font-bold text-slate-900">{{ stats.bookings_this_month }}</div>
            <div class="text-xs text-slate-500">Reservas mes</div>
        </div>
    </div>
    
    <!-- Secci√≥n: Mi Cuenta -->
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-100">
            <h3 class="font-bold text-slate-900">Mi Cuenta</h3>
        </div>
        
        <div class="divide-y divide-slate-100">
            <a href="{% url 'public_client_dashboard' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-blue-100 text-blue-600">üìä</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Panel de Control</div>
                    <div class="text-sm text-slate-500">Reservas, membres√≠as, actividad</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="#" onclick="openEditProfile()" class="menu-item">
                <div class="menu-icon bg-purple-100 text-purple-600">üë§</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Datos Personales</div>
                    <div class="text-sm text-slate-500">Nombre, email, tel√©fono, foto</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            {% if settings.show_pricing %}
            <a href="{% url 'public_my_memberships' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-green-100 text-green-600">üí≥</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Mis Membres√≠as</div>
                    <div class="text-sm text-slate-500">Planes activos y renovaciones</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            {% endif %}
            
            <a href="{% url 'public_chat' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-amber-100 text-amber-600">üí¨</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Chat con {{ gym.commercial_name|default:gym.name }}</div>
                    <div class="text-sm text-slate-500">Mensajes y consultas</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="{% url 'public_routines' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-teal-100 text-teal-600">üí™</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Mis Rutinas</div>
                    <div class="text-sm text-slate-500">Tu plan de entrenamiento</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            {% if referral_enabled %}
            <a href="{% url 'public_referrals' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-pink-100 text-pink-600">üéÅ</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Invitar Amigos</div>
                    <div class="text-sm text-slate-500">Comparte y gana recompensas</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Secci√≥n: Actividad -->
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-100">
            <h3 class="font-bold text-slate-900">Actividad</h3>
        </div>
        
        <div class="divide-y divide-slate-100">
            <a href="{% url 'public_schedule' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-indigo-100 text-indigo-600">üìÖ</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Reservar Clases</div>
                    <div class="text-sm text-slate-500">Horario y disponibilidad</div>
                </div>
                {% if upcoming_bookings_count > 0 %}
                <span class="px-2 py-1 bg-indigo-100 text-indigo-700 text-xs font-bold rounded-lg">{{ upcoming_bookings_count }}</span>
                {% endif %}
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="{% url 'public_attendance_history' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-teal-100 text-teal-600">üìú</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Historial de Asistencia</div>
                    <div class="text-sm text-slate-500">Clases a las que has asistido</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            {% if gamification_enabled %}
            <a href="{% url 'public_achievements' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-yellow-100 text-yellow-600">üèÜ</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Mis Logros</div>
                    <div class="text-sm text-slate-500">{{ achievements_unlocked }}/{{ achievements_total }} desbloqueados</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="{% url 'public_leaderboard' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-orange-100 text-orange-600">ü•á</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Ranking</div>
                    <div class="text-sm text-slate-500">Tu posici√≥n: #{{ rank_position }}</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            {% endif %}
        </div>
    </div>
    
    <!-- Secci√≥n: Comprar -->
    {% if settings.show_shop %}
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-100">
            <h3 class="font-bold text-slate-900">Comprar</h3>
        </div>
        
        <div class="divide-y divide-slate-100">
            <a href="{% url 'public_shop' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-pink-100 text-pink-600">üõí</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Tienda</div>
                    <div class="text-sm text-slate-500">Productos y suplementos</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="{% url 'public_orders_history' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-rose-100 text-rose-600">üì¶</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Mis Compras</div>
                    <div class="text-sm text-slate-500">Historial de pedidos</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
    {% endif %}
    
    <!-- Secci√≥n: Pagos -->
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-100">
            <h3 class="font-bold text-slate-900">Pagos</h3>
        </div>
        
        <div class="divide-y divide-slate-100">
            <a href="{% url 'public_payment_history' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-emerald-100 text-emerald-600">üí∞</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Historial de Pagos</div>
                    <div class="text-sm text-slate-500">Facturas y recibos</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            <a href="{% url 'public_payment_methods' slug=settings.public_slug %}" class="menu-item">
                <div class="menu-icon bg-cyan-100 text-cyan-600">üí≥</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">M√©todos de Pago</div>
                    <div class="text-sm text-slate-500">Tarjetas guardadas</div>
                </div>
                {% if has_saved_card %}
                <span class="px-2 py-1 bg-green-100 text-green-700 text-xs font-bold rounded-lg">‚Ä¢‚Ä¢‚Ä¢‚Ä¢ {{ last_card_digits }}</span>
                {% endif %}
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
    
    <!-- Secci√≥n: Soporte -->
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
        <div class="px-4 py-3 border-b border-slate-100">
            <h3 class="font-bold text-slate-900">Soporte</h3>
        </div>
        
        <div class="divide-y divide-slate-100">
            <a href="#" class="menu-item">
                <div class="menu-icon bg-slate-100 text-slate-600">‚ùì</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Ayuda y FAQ</div>
                    <div class="text-sm text-slate-500">Preguntas frecuentes</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            
            {% if gym.phone %}
            <a href="tel:{{ gym.phone }}" class="menu-item">
                <div class="menu-icon bg-blue-100 text-blue-600">üìû</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">Contactar</div>
                    <div class="text-sm text-slate-500">{{ gym.phone }}</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
            {% endif %}
            
            <a href="#" class="menu-item">
                <div class="menu-icon bg-gray-100 text-gray-600">üìã</div>
                <div class="flex-1">
                    <div class="font-semibold text-slate-900">T√©rminos y Condiciones</div>
                    <div class="text-sm text-slate-500">Pol√≠tica de privacidad</div>
                </div>
                <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                </svg>
            </a>
        </div>
    </div>
    
    <!-- Cerrar Sesi√≥n -->
    <a href="{% url 'public_logout' slug=settings.public_slug %}" class="block bg-white rounded-2xl shadow-lg border border-slate-100 p-4 text-center">
        <span class="text-red-600 font-semibold">üö™ Cerrar Sesi√≥n</span>
    </a>
    
    <!-- Versi√≥n -->
    <div class="text-center text-slate-400 text-xs py-4">
        {{ gym.commercial_name|default:gym.name }} ¬∑ Powered by New CRM
    </div>
</div>

<!-- Modal de Editar Perfil -->
<div id="editProfileModal" class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center" style="display: none;">
    <div class="bg-white w-full sm:max-w-md sm:rounded-2xl rounded-t-3xl shadow-2xl max-h-[90vh] overflow-y-auto">
        <div class="sticky top-0 bg-white border-b border-slate-100 p-4 flex items-center justify-between">
            <h3 class="text-lg font-bold">Editar Perfil</h3>
            <button onclick="closeEditProfile()" class="w-10 h-10 bg-slate-100 rounded-full flex items-center justify-center hover:bg-slate-200 transition-colors">
                <svg class="w-5 h-5 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        
        <form method="post" action="{% url 'public_client_profile' slug=settings.public_slug %}" enctype="multipart/form-data" class="p-4 space-y-4">
            {% csrf_token %}
            
            <!-- Foto -->
            <div class="text-center mb-6">
                <div class="w-24 h-24 mx-auto rounded-full bg-slate-200 flex items-center justify-center overflow-hidden mb-3">
                    {% if client.photo %}
                    <img src="{{ client.photo.url }}" alt="" class="w-full h-full object-cover" id="photoPreview">
                    {% else %}
                    <span class="text-3xl" id="photoPlaceholder">{{ client.first_name|slice:":1"|upper }}</span>
                    <img src="" alt="" class="w-full h-full object-cover hidden" id="photoPreview">
                    {% endif %}
                </div>
                <label class="inline-block cursor-pointer">
                    <span class="brand-text font-semibold text-sm">Cambiar foto</span>
                    <input type="file" name="photo" accept="image/*" class="hidden" onchange="previewPhoto(this)">
                </label>
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Nombre</label>
                <input type="text" name="first_name" value="{{ client.first_name }}" 
                       class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-[var(--brand-color)] focus:ring-2 focus:ring-[var(--brand-color)]/20 outline-none">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Apellidos</label>
                <input type="text" name="last_name" value="{{ client.last_name }}" 
                       class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-[var(--brand-color)] focus:ring-2 focus:ring-[var(--brand-color)]/20 outline-none">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Email</label>
                <input type="email" name="email" value="{{ client.email }}" 
                       class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-[var(--brand-color)] focus:ring-2 focus:ring-[var(--brand-color)]/20 outline-none">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Tel√©fono</label>
                <input type="tel" name="phone" value="{{ client.phone_number }}" 
                       class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-[var(--brand-color)] focus:ring-2 focus:ring-[var(--brand-color)]/20 outline-none">
            </div>
            
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Fecha de nacimiento</label>
                <input type="date" name="birth_date" value="{{ client.birth_date|date:'Y-m-d' }}" 
                       class="w-full px-4 py-3 rounded-xl border border-slate-300 focus:border-[var(--brand-color)] focus:ring-2 focus:ring-[var(--brand-color)]/20 outline-none">
            </div>
            
            <button type="submit" class="w-full brand-bg text-white font-bold py-4 rounded-xl hover:opacity-90 transition-opacity mt-6">
                Guardar Cambios
            </button>
        </form>
    </div>
</div>

<script>
function openEditProfile() {
    document.getElementById('editProfileModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

function closeEditProfile() {
    document.getElementById('editProfileModal').style.display = 'none';
    document.body.style.overflow = '';
}

function previewPhoto(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('photoPreview');
            const placeholder = document.getElementById('photoPlaceholder');
            preview.src = e.target.result;
            preview.classList.remove('hidden');
            if (placeholder) placeholder.style.display = 'none';
        }
        reader.readAsDataURL(input.files[0]);
    }
}

// Click fuera para cerrar
document.getElementById('editProfileModal').addEventListener('click', function(e) {
    if (e.target === this) closeEditProfile();
});
</script>
{% endblock %}
