{% extends 'public_portal/base.html' %}

{% block title %}{{ t.create_account }} - {{ gym.commercial_name|default:gym.name }}{% endblock %}

{% block content %}
<div class="max-w-md mx-auto">
    <div class="bg-white rounded-2xl shadow-lg border border-slate-100 p-8">
        <h1 class="text-2xl font-bold text-slate-900 mb-2">{{ t.create_account }}</h1>
        <p class="text-slate-600 mb-6">{{ t.join_us }} {{ gym.commercial_name|default:gym.name }}</p>
        
        <form method="post" class="space-y-4">
            {% csrf_token %}
            
            <!-- Selector de Gimnasio (si hay franquicia) -->
            {% if show_gym_selector %}
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl">
                <label class="block text-sm font-bold text-blue-900 mb-2">{{ t.select_gym }} *</label>
                <select name="gym_id" required 
                        class="w-full rounded-xl border-blue-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]">
                    <option value="">-- {{ t.choose_gym }} --</option>
                    {% for franchise_gym in franchise_gyms %}
                    <option value="{{ franchise_gym.id }}" {% if franchise_gym.id == gym.id %}selected{% endif %}>
                        {{ franchise_gym.commercial_name|default:franchise_gym.name }}
                        {% if franchise_gym.city %} - {{ franchise_gym.city }}{% endif %}
                    </option>
                    {% endfor %}
                </select>
                <p class="text-xs text-blue-700 mt-2">ðŸ’¡ {{ t.select_gym_desc }}</p>
            </div>
            {% endif %}
            
            <!-- Nombre -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.first_name }} *</label>
                    <input type="text" name="first_name" required 
                           class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                           placeholder="">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.last_name }} *</label>
                    <input type="text" name="last_name" required 
                           class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                           placeholder="">
                </div>
            </div>
            
            <!-- Email -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.email }} *</label>
                <input type="email" name="email" required 
                       class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                       placeholder="tu@email.com">
            </div>
            
            <!-- TelÃ©fono -->
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.phone }}</label>
                <input type="tel" name="phone_number" 
                       class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                       placeholder="+34 666 777 888">
            </div>
            
            <!-- Campos Custom del Gimnasio -->
            {% if custom_fields %}
            <div class="pt-4 border-t border-slate-200">
                <h3 class="text-sm font-bold text-slate-700 mb-3">{{ t.additional_info }}</h3>
                <div class="space-y-4">
                    {% for field in custom_fields %}
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">
                            {{ field.name }} {% if field.is_required %}<span class="text-red-500">*</span>{% endif %}
                        </label>
                        
                        {% if field.field_type == 'SELECT' %}
                        <select name="cf_{{ field.slug }}" 
                                {% if field.is_required %}required{% endif %}
                                class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]">
                            <option value="">-- {{ t.select_option }} --</option>
                            {% for option in field.options.all %}
                            <option value="{{ option.value }}">{{ option.label }}</option>
                            {% endfor %}
                        </select>
                        
                        {% elif field.field_type == 'TOGGLE' %}
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" name="cf_{{ field.slug }}" value="yes"
                                   class="rounded border-slate-300 text-[var(--brand-color)] focus:ring-[var(--brand-color)]">
                            <span class="text-sm text-slate-600">{{ t.yes }}</span>
                        </label>
                        
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
            
            <!-- ContraseÃ±a -->
            <div class="pt-4 border-t border-slate-200">
                <h3 class="text-sm font-bold text-slate-700 mb-3">{{ t.security }}</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.password }} *</label>
                        <input type="password" name="password" required 
                               class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                               placeholder="{{ t.min_characters }}">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">{{ t.confirm_password }} *</label>
                        <input type="password" name="password_confirm" required 
                               class="w-full rounded-xl border-slate-200 focus:border-[var(--brand-color)] focus:ring-[var(--brand-color)]"
                               placeholder="{{ t.repeat_password }}">
                    </div>
                </div>
            </div>
            
            <!-- TÃ©rminos -->
            <div class="flex items-start gap-2">
                <input type="checkbox" required 
                       class="mt-1 rounded border-slate-300 text-[var(--brand-color)] focus:ring-[var(--brand-color)]">
                <label class="text-sm text-slate-600">
                    {{ t.accept_terms }} - {{ gym.commercial_name|default:gym.name }}
                </label>
            </div>
            
            <!-- Botones -->
            <div class="flex flex-col gap-3 pt-4">
                <button type="submit" 
                        class="w-full brand-bg text-white font-bold py-3 rounded-xl hover:opacity-90 transition-opacity">
                    {{ t.create_account }}
                </button>
                <a href="{% url 'public_login' slug=settings.public_slug %}" 
                   class="text-center text-sm text-slate-600 hover:text-[var(--brand-color)]">
                    {{ t.already_have_account }}
                </a>
            </div>
        </form>
        
        {% if settings.require_staff_approval %}
        <div class="mt-6 p-4 bg-blue-50 border border-blue-100 rounded-xl text-sm text-blue-800">
            <strong>ðŸ“‹ </strong> {{ t.account_pending_review }}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
